<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>

    <!-- CSRF 토큰 정보 -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/login-skin/css/login-skin.css}" href="/static/login-skin/css/login-skin.css">

    <style>
        /* 필요한 경우 여기에 커스텀 스타일을 추가할 수 있습니다. */
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

<div id="app" class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
    <!-- 로고 이미지 삽입 위치 -->
    <!-- <img src="[로고 이미지 경로]" alt="로고" class="mx-auto h-12 w-auto mb-6"> -->
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">안녕하세요!</h2>
    <h2 class="text-xl text-center text-gray-600 mb-6">로그인 화면입니다.</h2>

    <form id="loginForm" class="space-y-6">
        <div>
            <label for="authUserId" class="block text-sm font-medium text-gray-700">아이디</label>
            <input type="text" id="authUserId" name="authUserId" placeholder="아이디" required
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
        </div>
        <div>
            <label for="authPassword" class="block text-sm font-medium text-gray-700">비밀번호</label>
            <input type="password" id="authPassword" name="authPassword" placeholder="비밀번호" required
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
        </div>
        <div>
            <button type="submit"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                로그인
            </button>
        </div>
    </form>
</div>

<script>
    // Vue.js 인스턴스 (필요시 사용)
    // const app = new Vue({
    //   el: '#app',
    //   data: {
    //     // Vue 데이터
    //   },
    //   methods: {
    //     // Vue 메소드
    //   }
    // });

    // GSAP 애니메이션 (필요시 사용)
    // gsap.from(".form-element", { duration: 1, y: 50, opacity: 0, stagger: 0.2 });

    document.getElementById("loginForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const userId = document.getElementById("authUserId").value;
        const userPw = document.getElementById("authPassword").value;

        const token = document.querySelector('meta[name="_csrf"]').getAttribute('content');
        const header = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

        const response = await fetch("/game-hub/api/v1/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                [header]: token
            },
            body: new URLSearchParams({
                authUserId: userId,
                authPassword: userPw
            })
        });

        if (response.ok) {
            const jwt = response.headers.get("Authorization"); // Bearer 토큰
            //alert("로그인 성공! 토큰: " + jwt);

            localStorage.setItem("jwt", jwt); // JWT 저장

            window.location.href = "/game-hub"; // 홈으로 이동
        } else {
            const msg = await response.text();
            alert("로그인 실패: " + msg);
            // GSAP를 사용하여 로그인 실패 시 흔들림 애니메이션 추가
            if (typeof gsap !== 'undefined') {
                gsap.to("#loginForm", {duration: 0.1, x: -10, repeat: 5, yoyo: true, clearProps: "x"});
            }
        }
    });
</script>

<!-- Custom JS -->
<script th:src="@{/login-skin/js/login-skin.js}"></script>

</body>
</html>
